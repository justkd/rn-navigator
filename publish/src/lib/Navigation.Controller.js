"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getNavigationController=void 0;const jsx_runtime_1=require("react/jsx-runtime"),react_1=require("react"),react_native_1=require("react-native"),expo_status_bar_1=require("expo-status-bar"),Navigation_animations_1=require("./Navigation.animations"),Navigation_hooks_1=require("./Navigation.hooks"),Navigation_context_1=require("./Navigation.context"),Navigation_reducer_1=require("./Navigation.reducer"),Navigation_tokens_1=require("./Navigation.tokens"),Navigation_ErrorView_1=require("./Navigation.ErrorView");function getNavigationController(){const NavigationContext=(0,react_1.createContext)(null);return{useNavigation(){const ctx=NavigationContext;return(0,react_1.useContext)(ctx)},NavigationController(props){const{routes:routes,initialRoute:initialRoute,backgroundColor:bgColor,backgroundImage:backgroundImage,backgrounds:backgrounds,topLevelController:topLevelController=!0}=props,animT=(0,react_1.useRef)(new react_native_1.Animated.Value(0)),animO=(0,react_1.useRef)(new react_native_1.Animated.Value(0)),{anims:anims,baseDur:baseDur}=(0,Navigation_animations_1.useNavigationAnimations)(animT,animO,Navigation_animations_1.NavigationAnimationTypes.translateLTR),{width:width,height:height}=(0,react_native_1.useWindowDimensions)(),backgroundImageStyle=(0,react_1.useMemo)((()=>({position:"absolute",flex:1,justifyContent:"center",width:width,height:height})),[width,height]),reducer=Navigation_reducer_1.navigationReducer,[state,dispatch]=(0,react_1.useReducer)(reducer,{queue:[],history:[],isNavigating:null,background:void 0}),$routes=routes,{ctx:ctx}=(0,Navigation_context_1.useNavigationContext)(state,dispatch,$routes,String(initialRoute),baseDur,backgrounds),CurrentView=(0,react_1.useMemo)((()=>{const key=state.queue[0]?.to,Current=routes[key];return Current?(0,jsx_runtime_1.jsx)(Current,{}):(0,jsx_runtime_1.jsx)(Navigation_ErrorView_1.NavigationErrorView,{})}),[routes,state]);return(0,Navigation_hooks_1.useNavigationHooks)(state,dispatch,String(initialRoute),anims,{topLevelController:topLevelController}),(0,jsx_runtime_1.jsxs)(NavigationContext.Provider,{value:ctx,children:[(0,jsx_runtime_1.jsx)(expo_status_bar_1.StatusBar,{}),(0,jsx_runtime_1.jsx)(react_native_1.ImageBackground,{style:[backgroundImageStyle,{backgroundColor:bgColor||"rgba(0,0,0,0)"}],resizeMode:"cover",source:backgroundImage??{}}),(0,jsx_runtime_1.jsx)(react_native_1.View,{pointerEvents:"none",style:[backgroundImageStyle,{opacity:Number(state.isNavigating!==Navigation_tokens_1.navDirTokens.error)}],children:Object.entries(backgrounds||{}).map((([k,v])=>{const{color:color,image:image}=v,{style:style,resizeMode:resizeMode,source:source}=image||{},{opacity:opacity,...style$}=style||{};return(0,jsx_runtime_1.jsx)(react_native_1.ImageBackground,{style:[backgroundImageStyle,{backgroundColor:color||"rgba(0,0,0,0)",opacity:Number(state?.background===k)},style$],resizeMode:resizeMode||"cover",source:source??{}},k)}))}),(0,jsx_runtime_1.jsx)(react_native_1.Animated.View,{style:{height:"100%",width:"100%",opacity:animO.current,transform:[{translateX:animT.current.interpolate({inputRange:[0,1],outputRange:[width,0]})}]},children:CurrentView})]})}}}exports.getNavigationController=getNavigationController;